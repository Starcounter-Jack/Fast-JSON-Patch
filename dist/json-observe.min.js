var JsonObserver=function(){function a(a){this.originalObject=a,this.cachedProxy=null,this.isRecording=!1,this.userCallback;var b=this;this.switchObserverOn=function(){b.defaultCallback=function(a){b.isRecording&&b.patches.push(a),b.userCallback&&b.userCallback(a)}},this.switchObserverOff=function(){b.defaultCallback=function(){}}}return a.prototype.deepClone=function(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}},a.prototype.escapePathComponent=function(a){return a.indexOf("/")===-1&&a.indexOf("~")===-1?a:a.replace(/~/g,"~0").replace(/\//g,"~1")},a.prototype.generateProxyAtPath=function(a,b){if(!a)return a;var c=this,d=new Proxy(a,{get:function(a,b,c){return"_proxy"===b.toString()||Reflect.get(a,b,c)},set:function(a,d,e){var f=b+"/"+c.escapePathComponent(d.toString());if(e&&"object"==typeof e&&e._proxy!==!0&&(e=c.generateProxyAtPath(e,f)),"undefined"==typeof e){if(a.hasOwnProperty(d))return Array.isArray(a)?c.defaultCallback({op:"replace",path:f,value:null}):c.defaultCallback({op:"remove",path:f}),Reflect.set(a,d,e);if(!Array.isArray(a))return Reflect.set(a,d,e)}return Array.isArray(a)&&!Number.isInteger(+d.toString())?Reflect.set(a,d,e):a.hasOwnProperty(d)?"undefined"==typeof a[d]?(Array.isArray(a)?c.defaultCallback({op:"replace",path:f,value:e}):c.defaultCallback({op:"add",path:f,value:e}),Reflect.set(a,d,e)):(c.defaultCallback({op:"replace",path:f,value:e}),Reflect.set(a,d,e)):(c.defaultCallback({op:"add",path:f,value:e}),Reflect.set(a,d,e))},deleteProperty:function(a,d){return"undefined"!=typeof a[d]&&c.defaultCallback({op:"remove",path:b+"/"+c.escapePathComponent(d.toString())}),Reflect.deleteProperty(a,d)}});return d},a.prototype._proxifyObjectTreeRecursively=function(a,b){for(var c in a)if(a.hasOwnProperty(c)&&"object"==typeof a[c]){var d=b+"/"+this.escapePathComponent(c);a[c]=this.generateProxyAtPath(a[c],d),this._proxifyObjectTreeRecursively(a[c],d)}return this.generateProxyAtPath(a,"")},a.prototype.proxifyObjectTree=function(a){this.switchObserverOff();var b=this._proxifyObjectTreeRecursively(a,"");return this.switchObserverOn(),b},a.prototype.observe=function(a,b){if(!a&&!b)throw new Error("You need to either record changes or pass a defaultCallback");return this.isRecording=a,b&&(this.userCallback=b),a&&(this.patches=[]),this.cachedProxy=this.proxifyObjectTree(this.deepClone(this.originalObject))},a.prototype.generate=function(){if(!this.isRecording)throw new Error("You should set record to true to get patches later");return this.patches.splice(0,this.patches.length)},a.prototype.unobserve=function(){return this.deepClone(this.cachedProxy)},a}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=JsonObserver;