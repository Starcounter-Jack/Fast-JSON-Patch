var JsonObserver=function(){function a(a){this.originalObject=a,this.cachedProxy=null,this.isRecording=!1,this.userCallback;var b=this;this.switchObserverOn=function(){b.defaultCallback=function(a){b.isRecording&&b.patches.push(a),b.userCallback&&b.userCallback(a)}},this.switchObserverOff=function(){b.defaultCallback=function(){}}}return a.deepClone=function(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}},a.escapePathComponent=function(a){return a.indexOf("/")===-1&&a.indexOf("~")===-1?a:a.replace(/~/g,"~0").replace(/\//g,"~1")},a.prototype.generateProxyAtPath=function(b,c){if(!b)return b;var d=this,e=new Proxy(b,{get:function(a,b,c){return"_proxy"===b.toString()||Reflect.get(a,b,c)},set:function(b,e,f){var g=c+"/"+a.escapePathComponent(e.toString());if(f&&"object"==typeof f&&f._proxy!==!0&&(f=d.generateProxyAtPath(f,g)),"undefined"==typeof f){if(b.hasOwnProperty(e))return Array.isArray(b)?d.defaultCallback({op:"replace",path:g,value:null}):d.defaultCallback({op:"remove",path:g}),Reflect.set(b,e,f);if(!Array.isArray(b))return Reflect.set(b,e,f)}return Array.isArray(b)&&!Number.isInteger(+e.toString())?Reflect.set(b,e,f):b.hasOwnProperty(e)?"undefined"==typeof b[e]?(Array.isArray(b)?d.defaultCallback({op:"replace",path:g,value:f}):d.defaultCallback({op:"add",path:g,value:f}),Reflect.set(b,e,f)):(d.defaultCallback({op:"replace",path:g,value:f}),Reflect.set(b,e,f)):(d.defaultCallback({op:"add",path:g,value:f}),Reflect.set(b,e,f))},deleteProperty:function(b,e){return"undefined"!=typeof b[e]&&d.defaultCallback({op:"remove",path:c+"/"+a.escapePathComponent(e.toString())}),Reflect.deleteProperty(b,e)}});return e},a.prototype._proxifyObjectTreeRecursively=function(b,c){for(var d in b)if(b.hasOwnProperty(d)&&"object"==typeof b[d]){var e=c+"/"+a.escapePathComponent(d);b[d]=this.generateProxyAtPath(b[d],e),this._proxifyObjectTreeRecursively(b[d],e)}return this.generateProxyAtPath(b,"")},a.prototype.proxifyObjectTree=function(a){this.switchObserverOff();var b=this._proxifyObjectTreeRecursively(a,"");return this.switchObserverOn(),b},a.prototype.observe=function(b,c){if(!b&&!c)throw new Error("You need to either record changes or pass a defaultCallback");return this.isRecording=b,c&&(this.userCallback=c),b&&(this.patches=[]),this.cachedProxy=this.proxifyObjectTree(a.deepClone(this.originalObject))},a.prototype.generate=function(){if(!this.isRecording)throw new Error("You should set record to true to get patches later");return this.patches.splice(0,this.patches.length)},a.prototype.unobserve=function(){return a.deepClone(this.cachedProxy)},a}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=JsonObserver;